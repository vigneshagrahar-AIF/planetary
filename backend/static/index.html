<!DOCTYPE html>
<html lang="en">
<head>
    <!-- =========================================================
         META & TITLE
    ========================================================== -->
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>Your Weight Across the Solar System</title>

    <!-- =========================================================
         FONTS
    ========================================================== -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Source+Sans+Pro:wght@400;600&family=Poppins:wght@400;600;700&display=swap"
          rel="stylesheet">

    <!-- =========================================================
         STYLES
    ========================================================== -->
    <style>
        /* =====================================================
           GLOBAL RESET & BASE
        ====================================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', system-ui, -apple-system,
                         BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow: hidden;                 /* desktop: one screen */
            background-color: #000;
            color: #fff;
        }

        body {
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        img {
            max-width: 100%;
            display: block;
        }

        button {
            font-family: inherit;
        }

        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* =====================================================
           MAIN WRAPPER WITH NEBULA BACKGROUND
           (served from /static/backgroundimg.jpg)
        ====================================================== */
        #report-wrapper {
            position: relative;
            min-height: 100vh;
            width: 100%;
            background:
                url('/static/backgroundimg.jpg')
                no-repeat center center;
            background-size: cover;
            isolation: isolate;               /* better blending */
        }

        /* Gentle animated star overlay */
        .stars {
            position: absolute;
            inset: 0;
            pointer-events: none;
            mix-blend-mode: screen;
            background:
                radial-gradient(circle at 20% 20%,
                    rgba(255,255,255,0.16) 0,
                    transparent 40%),
                radial-gradient(circle at 80% 10%,
                    rgba(255,255,255,0.12) 0,
                    transparent 45%),
                radial-gradient(circle at 50% 80%,
                    rgba(255,255,255,0.10) 0,
                    transparent 50%);
            animation: starAnimation 50s linear infinite;
            z-index: -1;
        }

        @keyframes starAnimation {
            0%   { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-120px, -80px, 0); }
        }

        /* Slight vignette from edges to center for focus */
        #report-wrapper::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse at center,
                    transparent 55%,
                    rgba(0,0,0,0.6) 100%);
            pointer-events: none;
            z-index: 0;
        }

        /* =====================================================
           MAIN APP LAYOUT
        ====================================================== */
        #app {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            padding-top: 18px;
            padding-bottom: 18px;
        }

        #app-inner {
            width: 100%;
            max-width: 1180px;
            padding-inline: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* =====================================================
           HEADER & LOGO
        ====================================================== */
        .logo {
            width: 260px;
            max-width: 80%;
            margin-bottom: 10px;
            transition: transform 0.3s ease,
                        filter 0.3s ease;
            animation: logoIn 1.5s ease-in-out;
            filter:
                drop-shadow(0 6px 12px rgba(0,0,0,0.45));
        }

        .logo:hover {
            transform: scale(1.03);
            filter:
                drop-shadow(0 10px 18px rgba(0,0,0,0.6));
        }

        @keyframes logoIn {
            0%   { opacity: 0; transform: translateY(-15px); }
            100% { opacity: 1; transform: translateY(0);      }
        }

        h1 {
            font-size: clamp(2.3rem, 3.3vw + 1rem, 3.4rem);
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 4px;
            text-shadow:
                0 0 24px rgba(0,0,0,0.55),
                0 0 40px rgba(10,0,40,0.7);
            animation: titleIn 1.6s ease-out;
        }

        .subheading {
            font-size: clamp(1rem, 1.2vw + 0.7rem, 1.4rem);
            font-weight: 500;
            margin-bottom: 14px;
            opacity: 0.96;
            max-width: 940px;
        }

        @keyframes titleIn {
            0%   { opacity: 0; transform: translateY(30px) scale(0.96); }
            100% { opacity: 1; transform: translateY(0)    scale(1);    }
        }

        /* Decorative horizontal glow line under title */
        .headline-divider {
            width: min(60%, 580px);
            height: 2px;
            margin-bottom: 8px;
            background:
                linear-gradient(90deg,
                    rgba(255,255,255,0) 0%,
                    rgba(255,255,255,0.6) 50%,
                    rgba(255,255,255,0) 100%);
            opacity: 0.9;
        }

        /* =====================================================
           START BUTTON & COUNTDOWN
        ====================================================== */
        #intro-screen {
            margin-top: 8px;
        }

        #start-btn {
            padding: 10px 32px;
            background: linear-gradient(135deg,
                        #ff8d22,
                        #ffaf3c);
            color: #fff;
            font-weight: 600;
            font-size: 1.25rem;
            border: none;
            border-radius: 999px;
            cursor: pointer;
            box-shadow:
                0 10px 28px rgba(0,0,0,0.45),
                0 0 0 0 rgba(255,141,34,0.4);
            transition:
                transform 0.18s ease,
                box-shadow 0.18s ease,
                filter 0.18s ease,
                background-position 0.18s ease;
            background-size: 200% 200%;
            background-position: 0 50%;
        }

        #start-btn:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow:
                0 14px 30px rgba(0,0,0,0.5),
                0 0 16px rgba(255,141,34,0.7);
            background-position: 100% 50%;
            filter: brightness(1.03);
        }

        #start-btn:focus-visible {
            outline: 3px solid #ffffff;
            outline-offset: 4px;
        }

        #countdown {
            margin-top: 12px;
        }

        #countdown h2 {
            font-size: 0.95rem;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            margin-bottom: 4px;
            opacity: 0.78;
        }

        #countdown-timer {
            font-size: 2.6rem;
            font-weight: 700;
            color: #ffcf47;
            text-shadow:
                0 0 14px rgba(0,0,0,0.8),
                0 0 30px rgba(255, 150, 0, 0.9);
        }

        /* =====================================================
           NAME + WEIGHT FORM
        ====================================================== */
        #manual-weight-section {
            margin-top: 12px;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background:
                linear-gradient(135deg,
                    rgba(0,0,0,0.55),
                    rgba(10,12,35,0.85));
            padding: 10px 16px 12px;
            border-radius: 18px;
            box-shadow:
                0 10px 26px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.12);
            backdrop-filter: blur(6px);
        }

        #manual-weight-section label {
            margin-right: 3px;
        }

        .input-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2px 0;
            flex-wrap: wrap;
            gap: 4px;
        }

        .field-label {
            min-width: 80px;
            text-align: right;
        }

        .text-input {
            padding: 6px 8px;
            margin: 1px 0;
            font-size: 0.9rem;
            width: 190px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.15);
            color: #fff;
            outline: none;
            transition:
                border-color 0.2s ease,
                box-shadow 0.2s ease,
                background 0.2s ease;
        }

        .text-input::placeholder {
            color: rgba(235,235,235,0.72);
        }

        .text-input:focus-visible {
            border-color: #ffcf47;
            box-shadow:
                0 0 0 1px rgba(0,0,0,0.5),
                0 0 0 4px rgba(255,207,71,0.4);
            background: rgba(20,20,20,0.9);
        }

        .text-input.error {
            border-color: #ff4a4a;
        }

        #submit-weight-btn {
            padding: 6px 22px;
            background: linear-gradient(135deg,
                        #2ecc71,
                        #19b463);
            color: #fff;
            font-size: 0.95rem;
            border: none;
            border-radius: 999px;
            cursor: pointer;
            margin-top: 4px;
            box-shadow:
                0 7px 18px rgba(0,0,0,0.45),
                0 0 10px rgba(46,204,113,0.55);
            transition:
                transform 0.18s ease,
                box-shadow 0.18s ease,
                filter 0.18s ease;
        }

        #submit-weight-btn:hover:enabled {
            transform: translateY(-1px) scale(1.01);
            box-shadow:
                0 10px 22px rgba(0,0,0,0.5),
                0 0 14px rgba(46,204,113,0.75);
            filter: brightness(1.02);
        }

        #submit-weight-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        #submit-weight-btn:focus-visible {
            outline: 3px solid #ffffff;
            outline-offset: 3px;
        }

        #manual-weight-error {
            font-size: 0.82rem;
            margin-top: 2px;
            min-height: 1.1em;
            color: #ffb5b5;
        }

        .helper-text {
            font-size: 0.8rem;
            opacity: 0.85;
            margin-top: 2px;
        }

        /* =====================================================
           REPORT / PLANET CARDS
        ====================================================== */
        #planet-selection {
            margin-top: 18px;
            width: 80%;
            max-width: 950px;
        }

        #planet-selection h2 {
            margin-bottom: 8px;
            font-size: 1.25rem;
            text-shadow: 0 0 10px rgba(0,0,0,0.65);
        }

        #planet-weights {
            display: grid;
            grid-template-columns: repeat(3, minmax(150px, 1fr));
            gap: 10px;
            justify-items: center;
        }

        .planet-card {
            background-color: #f1f1f1;
            border-radius: 18px;
            padding: 12px 10px 10px;
            box-shadow:
                0 6px 16px rgba(0,0,0,0.4);
            color: #333;
            width: 170px;
            transform-origin: center;
            transition:
                transform 0.2s ease,
                box-shadow 0.2s ease,
                background 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .planet-card::before {
            content: "";
            position: absolute;
            inset: -40%;
            background:
                radial-gradient(circle at 10% 0,
                    rgba(255,255,255,0.25) 0,
                    transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .planet-card:hover::before {
            opacity: 1;
        }

        .planet-card:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow:
                0 12px 26px rgba(0,0,0,0.55);
            background: linear-gradient(145deg,
                        #ffffff,
                        #e0f1ff);
        }

        .planet-card img {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            margin: 0 auto 6px;
            object-fit: cover;
            box-shadow:
                0 4px 10px rgba(0,0,0,0.28);
        }

        .planet-name {
            font-size: 0.96rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .planet-weight {
            font-size: 0.86rem;
            color: #555;
        }

        .planet-tagline {
            font-size: 0.75rem;
            margin-top: 4px;
            color: #777;
        }

        #print-btn {
            margin-top: 10px;
            padding: 8px 26px;
            background: linear-gradient(135deg,
                        #ff8d22,
                        #ffb347);
            color: #fff;
            font-size: 1rem;
            border: none;
            border-radius: 999px;
            cursor: pointer;
            box-shadow:
                0 9px 22px rgba(0,0,0,0.45),
                0 0 12px rgba(255,141,34,0.7);
            transition:
                transform 0.18s ease,
                box-shadow 0.18s ease,
                filter 0.18s ease;
        }

        #print-btn:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow:
                0 12px 26px rgba(0,0,0,0.55),
                0 0 18px rgba(255,141,34,0.9);
            filter: brightness(1.03);
        }

        #print-btn:focus-visible {
            outline: 3px solid #ffffff;
            outline-offset: 3px;
        }

        /* =====================================================
           ASTRONAUT + CAMERA (relative alignment kept)
        ====================================================== */
        #astronaut-container {
            position: fixed;
            top: 4%;
            right: 1%;
            z-index: 999;
            cursor: pointer;
            width: 750px;
            height: 750px;
            transform: scale(0.55); /* scaled to fit laptop screen */
            transform-origin: top right;
        }

        #astronaut-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow:
                0 0 15px rgba(0,0,0,0.35),
                0 20px 45px rgba(0,0,0,0.7);
        }

        /* Helmet window with camera feed */
        #camera-preview {
            position: absolute;
            top: 25%;
            left: 52%;
            transform: translate(-50%, -50%);
            width: 245px;
            height: 200px;
            border-radius: 38%;
            border: 5px solid #000000e0;
            box-shadow:
                0 0 60px rgba(0,0,0,0.7);
            overflow: hidden;
            display: none;
            background: #000;
        }

        #camera-preview::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 38%;
            box-shadow:
                0 0 70px rgba(0,0,0,0.9) inset,
                0 0 12px rgba(53,51,51,0.5);
            pointer-events: none;
        }

        #camera-preview video,
        #camera-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scale(1.5);
            -webkit-mask-image:
                radial-gradient(circle at 50% 50%,
                    rgba(0,0,0,1) 55%,
                    rgba(0,0,0,0) 95%);
            mask-image:
                radial-gradient(circle at 50% 50%,
                    rgba(0,0,0,1) 55%,
                    rgba(0,0,0,0) 95%);
        }

        #capture-btn {
            padding: 6px 18px;
            background-color: #e74c3c;
            color: #fff;
            font-size: 0.9rem;
            border: none;
            border-radius: 999px;
            cursor: pointer;
            transition: 0.25s;
            display: block;
            margin: 4px auto 0;
            box-shadow:
                0 6px 16px rgba(0,0,0,0.55),
                0 0 12px rgba(231,76,60,0.75);
        }

        #capture-btn:hover:enabled {
            background-color: #c0392b;
            transform: translateY(-1px) scale(1.02);
        }

        #capture-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        #capture-btn:focus-visible {
            outline: 3px solid #fff;
            outline-offset: 3px;
        }

        /* =====================================================
           VIDEO SECTION FOOTER
        ====================================================== */
        .video-section {
            width: 100%;
            max-width: 950px;
            max-height: 220px;
            overflow: hidden;
            margin-top: 14px;
            border-radius: 16px;
            box-shadow:
                0 10px 28px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.18);
            backdrop-filter: blur(3px);
        }

        .hero-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* =====================================================
           AUDIO PLAYER
        ====================================================== */
        #bg-audio {
            position: fixed;
            bottom: 6px;
            left: 6px;
            z-index: 1000;
            transform: scale(0.8);
            transform-origin: bottom left;
            opacity: 0.96;
        }

        /* =====================================================
           PRINT SNAPSHOT WRAPPER (image only)
        ====================================================== */
        #print-snapshot-wrapper {
            display: none;
            text-align: center;
            background: #000;
            width: 100%;
            height: 100%;
        }

        #print-snapshot-img {
            max-width: 100%;
            max-height: 100vh;
        }

        /* =====================================================
           SNAPSHOT MODE (for html2canvas)
           - Disable fancy masks so face actually appears
        ====================================================== */
        .snapshot-mode #camera-preview img,
        .snapshot-mode #camera-preview video {
            -webkit-mask-image: none !important;
            mask-image: none !important;
        }

        /* =====================================================
           RESPONSIVE TWEAKS
        ====================================================== */
        @media (max-width: 1200px) {
            #astronaut-container {
                transform: scale(0.48);
            }
        }

        @media (max-width: 900px) {
            html,
            body {
                overflow-y: auto; /* allow scroll on smaller devices */
            }

            #app {
                padding-bottom: 40px;
            }

            #planet-weights {
                grid-template-columns: repeat(2, minmax(150px, 1fr));
            }

            #astronaut-container {
                position: static;
                margin-top: 12px;
                width: 420px;
                height: 420px;
                transform: none;
            }
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2.2rem;
            }

            .subheading {
                font-size: 1rem;
            }

            #start-btn {
                font-size: 1.1rem;
                padding: 8px 20px;
            }

            #planet-weights {
                grid-template-columns: 1fr;
            }

            .video-section {
                max-height: 200px;
            }

            #manual-weight-section {
                width: 100%;
            }

            .field-label {
                text-align: left;
            }
        }

        /* =====================================================
           PRINT: (we now mostly use jsPDF, but keep a minimal
                   rule set if user prints page directly)
        ====================================================== */
        @media print {
            html,
            body {
                overflow: visible !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                background: #000 !important;
            }

            #report-wrapper {
                display: none !important;
            }

            #print-snapshot-wrapper {
                display: block !important;
            }

            #bg-audio {
                display: none !important;
            }
        }
    </style>
</head>

<body>
<!-- =========================================================
     MAIN VISUAL WRAPPER (NEBULA + CONTENT)
========================================================== -->
<div id="report-wrapper">
    <div class="stars"></div>

    <main id="app" aria-label="Your weight across the Solar System experience">
        <div id="app-inner">
            <!-- Logo -->
            <img src="http://agastya-campus-virtual-tour-website.s3-website-us-west-1.amazonaws.com/skin/Image_F01D836E_FAA5_5719_41D4_A5A371EB379E.png?v=1627551939283"
                 alt="Agastya Logo"
                 class="logo">

            <!-- Title & tagline -->
            <h1>Your Weight Across the Solar System</h1>
            <div class="headline-divider" aria-hidden="true"></div>
            <p class="subheading">
                Ever wondered how much you would weigh on other planets?
                Enter your details, capture your space selfie, and get your
                personalised space weight report!
            </p>

            <!-- =================================================
                 START BUTTON / INTRO
            ================================================== -->
            <section id="intro-screen"
                     aria-label="Introduction section with start button">
                <button id="start-btn" type="button" onclick="startProcess()">
                    Start Your Journey
                </button>
            </section>

            <!-- =================================================
                 COUNTDOWN
            ================================================== -->
            <section id="countdown" class="hidden"
                     aria-live="polite"
                     aria-label="Countdown before entering details">
                <h2>Launching in...</h2>
                <p id="countdown-timer">3</p>
            </section>

            <!-- =================================================
                 NAME + WEIGHT FORM
            ================================================== -->
            <section id="manual-weight-section" class="hidden"
                     aria-label="Enter your name and weight to see results">
                <div class="input-row">
                    <span class="field-label">Your Name:</span>
                    <input id="name-input"
                           class="text-input"
                           type="text"
                           placeholder="Enter your name"
                           autocomplete="name"
                           aria-label="Your Name">
                </div>

                <div class="input-row">
                    <span class="field-label">Your Weight (kg):</span>
                    <input id="manual-weight-input"
                           class="text-input"
                           type="number"
                           placeholder="Enter weight in kg"
                           step="0.1"
                           aria-label="Your weight in kilograms">
                </div>

                <button id="submit-weight-btn"
                        type="button"
                        onclick="submitWeight()">
                    Submit
                </button>

                <p id="manual-weight-error" role="alert"></p>
                <p class="helper-text">
                    Tip: Use your weight on Earth, and we’ll calculate how you’d
                    feel on each planet.
                </p>
            </section>

            <!-- =================================================
                 REPORT SECTION (PLANET CARDS + PRINT BUTTON)
            ================================================== -->
            <section id="planet-selection" class="hidden"
                     aria-label="Your personalised planet weight report">
                <h2 id="report-title">Your Space Weight Report</h2>

                <div id="planet-weights"
                     aria-live="polite"
                     aria-label="Weights on different planets">
                    <!-- Cards injected via JS -->
                </div>

                <button id="print-btn"
                        type="button"
                        onclick="prepareSnapshotAndPrint()">
                    Print Space Report (PDF)
                </button>
            </section>
        </div>

        <!-- =====================================================
             ASTRONAUT + CAMERA SECTION
        ====================================================== -->
        <section id="astronaut-container"
                 aria-label="Astronaut with camera preview in helmet">
            <img src="https://transparent.craiyon.com/2025-11-20/5EyRwmn3QX-A1Sqn37AXig.webp"
                 id="astronaut-img"
                 alt="Astronaut illustration">

            <div id="camera-preview" aria-hidden="true">
                <video id="video" autoplay muted></video>
            </div>

            <button id="capture-btn"
                    type="button"
                    onclick="capturePhoto()">
                Capture Photo
            </button>
        </section>

        <!-- =====================================================
             VIDEO FOOTER SECTION
        ====================================================== -->
        <section class="video-section"
                 aria-label="Space exploration video background">
            <video autoplay muted loop playsinline class="hero-video">
                <source src="https://video.wixstatic.com/video/e54a34_8be4b46d347a494bb38c03de5073ce9e/480p/mp4/file.mp4"
                        type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </section>
    </main>
</div>

<!-- =========================================================
     PRINT SNAPSHOT WRAPPER (FOR PRINT / PDF ONLY)
========================================================== -->
<div id="print-snapshot-wrapper">
    <img id="print-snapshot-img" alt="Space Weight Report Snapshot">
</div>

<!-- =========================================================
     BACKGROUND AUDIO (LOOPING SPACE AMBIENCE)
========================================================== -->
<audio id="bg-audio" src="space-ambience.mp3" loop controls>
    Your browser does not support the audio element.
</audio>

<!-- =========================================================
     SCRIPTS & LIBRARIES
========================================================== -->
<script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
    /* =========================================================
       PLANET CONFIG
    ========================================================== */

    const PLANETS = [
        "Mercury",
        "Venus",
        "Earth",
        "Mars",
        "Jupiter",
        "Saturn"
    ];

    // Relative gravity factors compared to Earth
    const PLANET_FACTORS = {
        Mercury: 0.38,
        Venus:   0.91,
        Earth:   1.00,
        Mars:    0.38,
        Jupiter: 2.53,
        Saturn:  1.07
    };

    // Planet images served from /static
    const PLANET_IMAGES = {
        Mercury: "/static/mercury.jpg",
        Venus:   "/static/venus.jpg",
        Earth:   "/static/earth.jpg",
        Mars:    "/static/mars.jpg",
        Jupiter: "/static/jupiter.jpg",
        Saturn:  "/static/saturn.jpg"
    };

    // Short, fun tagline for each planet
    const PLANET_TAGLINES = {
        Mercury: "Closest to the Sun!",
        Venus:   "Cloudy and scorching.",
        Earth:   "Home sweet home.",
        Mars:    "The red frontier.",
        Jupiter: "The giant among giants.",
        Saturn:  "Rings of wonder."
    };

    function planetImageUrl(planet) {
        return PLANET_IMAGES[planet];
    }

    /* =========================================================
       STATE & SHARED ELEMENTS
    ========================================================== */

    let countdownInterval = null;

    const nameInput         = document.getElementById("name-input");
    const weightInput       = document.getElementById("manual-weight-input");
    const errorEl           = document.getElementById("manual-weight-error");
    const submitBtn         = document.getElementById("submit-weight-btn");
    const reportTitle       = document.getElementById("report-title");
    const planetWeightsWrap = document.getElementById("planet-weights");

    const introScreen  = document.getElementById("intro-screen");
    const countdownBox = document.getElementById("countdown");
    const countdownTimerEl = document.getElementById("countdown-timer");
    const manualSection = document.getElementById("manual-weight-section");
    const planetSection = document.getElementById("planet-selection");

    const bgAudio = document.getElementById("bg-audio");

    /* =========================================================
       INTRO / COUNTDOWN LOGIC
    ========================================================== */

    function startProcess() {
        // Hide intro, show countdown
        introScreen.classList.add("hidden");
        countdownBox.classList.remove("hidden");

        // Try to start audio (may be blocked until user interaction)
        if (bgAudio) {
            bgAudio.play().catch(() => {});
        }

        let remaining = 3;
        countdownTimerEl.textContent = remaining.toString();

        if (countdownInterval) {
            clearInterval(countdownInterval);
        }

        countdownInterval = setInterval(() => {
            remaining -= 1;

            if (remaining <= 0) {
                clearInterval(countdownInterval);
                countdownBox.classList.add("hidden");
                manualSection.classList.remove("hidden");
                nameInput.focus();
            } else {
                countdownTimerEl.textContent = remaining.toString();
            }
        }, 1000);
    }

    /* =========================================================
       PLANET CARD RENDERING
    ========================================================== */

    function showPlanetCards(weightKg, name) {
        let html = "";

        PLANETS.forEach((planet) => {
            const factor = PLANET_FACTORS[planet];
            const imgUrl = planetImageUrl(planet);
            const weightOnPlanet = (weightKg * factor).toFixed(2);
            const tagline = PLANET_TAGLINES[planet] || "";

            html += `
                <article class="planet-card" aria-label="${planet} weight card">
                    <img src="${imgUrl}" alt="${planet} image">
                    <h3 class="planet-name">${planet}</h3>
                    <p class="planet-weight">${weightOnPlanet} kg</p>
                    <p class="planet-tagline">${tagline}</p>
                </article>
            `;
        });

        planetWeightsWrap.innerHTML = html;

        if (name && name.trim() !== "") {
            reportTitle.textContent = `${name}'s Space Weight Report`;
        } else {
            reportTitle.textContent = "Your Space Weight Report";
        }

        planetSection.classList.remove("hidden");
        planetSection.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    /* =========================================================
       FORM HANDLING / VALIDATION
    ========================================================== */

    function clearError() {
        errorEl.textContent = "";
        weightInput.classList.remove("error");
    }

    function setError(msg) {
        errorEl.textContent = msg;
    }

    function submitWeight() {
        clearError();

        const name   = nameInput.value.trim();
        const weight = parseFloat(weightInput.value);

        if (!name) {
            setError("Please enter your name.");
            nameInput.focus();
            return;
        }

        if (isNaN(weight) || weight <= 0) {
            weightInput.classList.add("error");
            setError("Please enter a valid weight in kg (greater than 0).");
            weightInput.focus();
            return;
        }

        showPlanetCards(weight, name);
    }

    // Allow "Enter" key on weight field to submit
    weightInput.addEventListener("keydown", (ev) => {
        if (ev.key === "Enter") {
            ev.preventDefault();
            submitWeight();
        }
    });

    nameInput.addEventListener("keydown", (ev) => {
        if (ev.key === "Enter") {
            ev.preventDefault();
            weightInput.focus();
        }
    });

    /* =========================================================
       CAMERA CAPTURE LOGIC
    ========================================================== */

    function capturePhoto() {
        const captureBtn = document.getElementById("capture-btn");
        const video      = document.getElementById("video");
        const preview    = document.getElementById("camera-preview");

        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            alert("Camera access is not supported in this browser.");
            return;
        }

        captureBtn.disabled = true;

        navigator.mediaDevices
            .getUserMedia({ video: true })
            .then((stream) => {
                video.srcObject = stream;
                preview.style.display = "block";

                // Capture after 10 seconds to give time to pose
                setTimeout(() => {
                    const canvas = document.createElement("canvas");
                    canvas.width  = 200;
                    canvas.height = 200;
                    const ctx = canvas.getContext("2d");
                    ctx.drawImage(video, 0, 0, 200, 200);

                    const imgUrl = canvas.toDataURL("image/png");
                    const img = document.createElement("img");
                    img.src = imgUrl;

                    preview.innerHTML = "";
                    preview.appendChild(img);

                    stream.getTracks().forEach((t) => t.stop());
                    captureBtn.disabled = false;
                }, 10000);
            })
            .catch((err) => {
                console.error("Error accessing camera:", err);
                alert("Could not access the camera. Please check permissions.");
                captureBtn.disabled = false;
            });
    }

    /* =========================================================
       SNAPSHOT + PDF GENERATION (html2canvas + jsPDF)
    ========================================================== */

    async function prepareSnapshotAndPrint() {
        const wrapper     = document.getElementById("report-wrapper");
        const snapshotImg = document.getElementById("print-snapshot-img");

        const rawName = nameInput.value || "Space Report";

        const safeName = (rawName || "Space Report")
            .trim()
            .replace(/[^a-z0-9\s\-]/gi, "")
            .replace(/\s+/g, "_") || "Space_Report";

        const originalScrollY = window.scrollY;

        document.body.classList.add("snapshot-mode");
        window.scrollTo(0, 0);

        try {
            const canvas = await html2canvas(wrapper, {
                scale: 2,
                useCORS: true,
                backgroundColor: null,
                scrollX: 0,
                scrollY: 0,
                windowWidth: document.documentElement.clientWidth,
                windowHeight: document.documentElement.clientHeight
            });

            const imgData = canvas.toDataURL("image/png");
            snapshotImg.src = imgData;

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: "landscape",
                unit: "px",
                format: [canvas.width, canvas.height]
            });

            pdf.addImage(imgData, "PNG", 0, 0, canvas.width, canvas.height);
            pdf.save(`${safeName}_Space_Weight_Report.pdf`);
        } catch (err) {
            console.error("Snapshot / PDF generation failed:", err);
            alert("PDF generation failed. As a fallback, use your browser's print feature.");
        } finally {
            document.body.classList.remove("snapshot-mode");
            window.scrollTo(0, originalScrollY);
        }
    }
</script>
</body>
</html>
